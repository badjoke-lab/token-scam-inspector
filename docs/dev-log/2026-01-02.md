
### Task 06 でできるようになること（完了後・

* **「売れない／売りづらい可能性」チェックが1つ動く**（unknown以外が出るケースが出てくる）
* **なぜそう言えるのか**が evidence として残る（例：ブラックリスト/取引制御っぽい記述を検出）
* ソース未公開などの場合も **unknown＋理由＋確認手順**を返せる

---

## ✅ タスク文ここから

```md
# Task 06 — Check 01: Sell Restriction / Honeypot (Phase 1 / Stage 4)

## PR title rule (MUST)
Set the PR title to:
- **Task 06: Check 01 (sell restriction)**

## What is this check?
Check #1 in the spec: **Sell Restriction / Honeypot**
Goal is to detect *signals* that selling may be blocked or heavily restricted.
No verdict language. No scoring.

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**` (spec-phase1-ja.md section “① Sell Restriction / Honeypot”)
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `workers/**`
- Must NOT edit: `docs/specs/**`

## Constraints (MUST)
- Do NOT add new endpoints
- Do NOT change response schema (no new top-level keys)
- Do NOT introduce “scam/safe/fraud” or investment advice
- Cache behavior must remain: HIT returns immediately

## Implementation plan

### 1) Implement `sell_restriction` check using **source-code pattern scan** (best-effort)
Use explorer data already introduced in Task 05:
- If contract source is available/verified and code text can be obtained:
  - Scan code for **common sell restriction signals** (simple string/pattern match only).
  - Examples of signals (keep minimal, no heavy parsing):
    - blacklist/whitelist gating: `blacklist`, `isBlacklisted`, `whitelist`, `onlyWhitelisted`
    - trading switch / transfer gate: `tradingEnabled`, `enableTrading`, `tradingOpen`, `whenTradingEnabled`
    - anti-bot / transfer delay that can block sells: `antiBot`, `cooldown`, `transferDelay`
    - explicit sell limitation hints: `maxSell`, `sellLimit`, `sellTax`
  - Based on findings, set result:
    - `high` : explicit blacklist/whitelist gating OR explicit trading switch that can block transfers
    - `warn` : anti-bot/cooldown/delay or tax-related hints (uncertain but relevant)
    - `ok`   : verified source exists AND none of the above signals found (still not a verdict)
- If source is missing/unverified/unavailable:
  - result must be `unknown` with an explainable reason (e.g. `source_unavailable` / `missing_api_key` / `upstream_error`)

### 2) Populate the check object strictly per schema
For the check item with:
- `id`: `sell_restriction`
- `label`: `Sell Restriction / Honeypot`

Fill:
- `result`: `ok | warn | high | unknown`
- `short`: keep spec short text (beginner-friendly)
- `detail`: keep spec detail text (beginner-friendly)
- `evidence`: include **concrete detected tokens** (e.g., `Found "blacklist" pattern`)
- `howToVerify`: include neutral steps (spec-aligned), e.g.
  - “Try a tiny swap on a trusted tool”
  - “Check explorer verified source / read the transfer restrictions”
(Do NOT add new fields)

### 3) Keep it neutral
Forbidden words:
- “scam”, “fraud”, “safe”
Forbidden advice:
- “buy/sell”, “you should invest”

Allowed:
- “risk signal”, “might”, “could”, “unknown”, “insufficient data”

### 4) Preserve cache behavior
- Cache HIT: return immediately (do not scan / do not call explorer)
- Cache MISS: run existing pipeline, compute this check, then cache result (Task 04 rules)

## Acceptance checklist
- [ ] `sell_restriction` check returns `unknown` with reason when source is unavailable
- [ ] When source exists, check returns `warn/high/ok` based on minimal pattern scan
- [ ] `evidence` contains at least 1 concrete string when result != unknown
- [ ] `howToVerify` is filled with beginner-friendly neutral steps
- [ ] No schema changes, no new endpoints
- [ ] No forbidden words / no scoring
- [ ] Cache HIT behavior unchanged
- [ ] No edits to `docs/specs/**`
```

## ✅ タスク文ここまで

---
https://github.com/badjoke-lab/token-scam-inspector/pull/7

https://da0ec44b.token-scam-inspector.pages.dev/




### Task 07 でできるようになること（完了後・ざっくり）

* `/api/inspect` に **Check②（Owner Privileges / オーナー権限）** が追加され、**unknown以外（ok/warn/high）** が返るケースが出てくる
* **「なぜそう言えるか」** を `why` と `evidence` で説明できる（断定なし）
* 次の Task 08（Check③）以降を **同じ型で積み増し**できる

---

## ✅ タスク文ここから

```md
# Task 07 — Check ②: Owner Privileges (Phase 1 / Stage 4)

## PR title rule (MUST)
Set the PR title to:
- **Task 07: Check 02 (owner privileges)**

## What is Check ②?
**Owner Privileges（オーナー権限）**
- 目的：開発者（owner）が後から重要ルールを変更できる設計かどうか、という「リスクになりやすいシグナル」を検出する。
- 注意：これは断定ではない。可能性/シグナルとして説明する。

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**`（spec-phase1-ja.md の「② Owner Privileges」定義を厳密に採用）
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `workers/**`
- Must NOT edit: `docs/specs/**`

## Hard constraints (MUST)
- No new endpoints
- No schema changes（レスポンスのトップレベルキー追加禁止）
- No scoring/ranking/points
- No verdict words（scam/fraud/safe 等）& 投資助言禁止
- Cache HIT は即return（上流呼び出し・解析をしない）

---

## Implementation requirements

### 1) Identify the exact check object from specs
Implement Check②を **仕様書どおりの id/label/説明文** で `checks[]` に入れる。
- id / label / short / detail / howToVerify（仕様にあるなら）を一致させる
- 仕様にない文言を勝手に作らない（必要なら最小限の補助だけ）

### 2) Use only currently available data (Phase 1)
使ってよい情報：
- Task 05 で取得できる Explorer データ（ETH/BSC）
- Explorer から取れる “ソース/ABI/関数名/文字列” 等の範囲（存在する場合のみ）

禁止：
- HTMLスクレイピング
- 新しい外部API追加
- 新しいインフラ（DB/KV/R2等）

### 3) Detection approach (best-effort, explainable)
仕様に沿って「owner権限のシグナル」を拾う。実装は軽く：

- ソース/ABI が取得できる場合：
  - owner痕跡（例：`owner`, `onlyOwner`, `transferOwnership`, `renounceOwnership` など）の存在を確認
  - ルール変更系の“ヒント”関数名/文字列（例：`setFee/setTax/setMaxTx/setMaxWallet/blacklist/whitelist` 等）を **pattern scan** で拾う
  - 見つけたものは `evidence` に「見つかった語/関数名」として列挙（断定しない）

- 取得できない場合（未verified / APIキーなし / rate limit 等）：
  - 結果は `unknown`
  - `why` に「なぜ確認できないか」を明記
  - `evidence` にも `code: missing_api_key` 等の説明を残す（スキーマの許す範囲で）

### 4) Result classification (must follow spec wording)
Check②の `result` は仕様書のルールに従って：
- `ok | warn | high | unknown` のいずれか

実装上の最低要件（※最終判断は specs に完全準拠）：
- `unknown`：必要データが取れない
- `warn/high`：owner痕跡があり、変更系シグナルが見つかった（強さは仕様の定義に合わせる）
- `ok`：仕様が ok を許す条件を満たす場合のみ（無理にokにしない）

### 5) Evidence / how to verify
- `result != unknown` のとき `evidence` は最低1件入れる
  - 例：Explorer URL、検出した語/関数名、取得元（explorer）など
- `howToVerify` が仕様にあるなら必ず埋める
  - 無い場合は `why` の末尾に「確認方法（中立）」を短く追記

### 6) Preserve caching behavior
- Cache HIT：即 return（このチェック計算も含め “キャッシュ済み結果” を返す）
- Cache MISS：現行のパイプラインで上流取得→本チェック評価→レスポンス→キャッシュ保存（Task 04方針維持）

---

## Acceptance checklist
- [ ] Check②が specs の順番/名称/id で実装されている（勝手に変えてない）
- [ ] データが取れるとき `ok/warn/high` が返るケースがある
- [ ] 取れないとき `unknown` + 理由（why）が返る
- [ ] `result != unknown` のとき evidence が最低1件ある
- [ ] スキーマ変更なし／新規エンドポイントなし
- [ ] 禁止ワード/助言/スコア化なし
- [ ] Cache HIT の挙動が崩れていない
- [ ] `docs/specs/**` を編集していない
```

## ✅ タスク文ここまで

https://github.com/badjoke-lab/token-scam-inspector/pull/8


