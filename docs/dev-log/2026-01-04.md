
## Task 14 でできるようになること（完了後・ざっくり）

* ブラウザ上で **chain と address を入力**できる
* ボタンを押すと **`/api/inspect` を呼ぶ**（Workers API連携が始まる）
* 返ってきたJSONを **暫定表示（そのまま）**できる（まず動く状態）

---

## ✅ タスク文ここから

```md
# Task 14 — UI: Input + Call /api/inspect + Show Raw JSON (Phase 1 / Stage 5)

## PR title rule (MUST)
Set the PR title to:
- **Task 14: UI input + inspect call (raw JSON)**

## Goal
Build the first functional UI:
- Input form for `chain` and `address`
- Call `/api/inspect`
- Display the returned JSON in a simple raw format (pre/code block)
No styling beyond minimal readability.

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**`（ui-spec-ja.md / spec-phase1-ja.md）
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `app/**`, `README.md` (minimal if needed)
- Must NOT edit: `docs/specs/**`
- Must NOT change workers in this task（UIだけ）

## Hard constraints (MUST)
- No UI beautification（カード/影/アニメ/凝ったレイアウト禁止）
- No verdict/scoring/investment advice wording
- Mobile-safe（横スクロールなし）
- Keep it simple: 1 page only

---

## UI requirements

### 1) Update `app/index.html`
Add a simple form:
- `chain` input (text or select)
  - Default: `eth`
  - Allow at least: `eth`, `bsc`
- `address` input (text)
- A button: "Inspect" (or similar neutral label)
- A small note:
  - "This tool shows risk signals with explanations. Not a verdict."
  - "No investment advice."

Add a result area:
- Status line (idle/loading/success/error)
- Raw JSON display:
  - `<pre><code id="result"></code></pre>`

### 2) Implement logic in `app/app.js`
- On submit:
  - Read chain + address
  - Build request URL:
    - Prefer GET query: `/api/inspect?chain=...&address=...`
    - (If current API expects POST, follow existing worker implementation — but do not change workers in this task.)
  - Show loading state
  - Fetch and parse JSON
  - Render JSON as pretty-printed text:
    - `JSON.stringify(data, null, 2)`
- Error handling:
  - Network error -> show neutral message
  - Non-200 -> still try to parse JSON, show it
- Prevent double-submit while loading

### 3) Minimal CSS update (`app/style.css`)
Only minimal readability:
- Inputs full width on mobile
- Button spacing
- `<pre>` scrollable horizontally ONLY inside pre if needed (page must not overflow)
- Keep existing simple styles; do not add fancy design

### 4) No extra features
- No history
- No sample tokens list
- No auto-validate beyond simple trimming/lowercasing
- No additional pages

## Acceptance checklist
- [ ] UI has chain + address inputs and an Inspect button
- [ ] Clicking Inspect calls `/api/inspect` and shows returned JSON
- [ ] Loading/error states are visible
- [ ] Mobile-safe (no horizontal scroll on the page)
- [ ] No workers changes in this task
- [ ] No edits to `docs/specs/**`
```

## ✅ タスク文ここまで




エラー発生で１４−１
状況は把握した。**今の `pages.dev/api/inspect` は Workers のJSONじゃなく、PagesのHTML（= UIページ）を返してる**。
だから UI 側は「JSONとして読めないHTML」を掴んで壊れる（前のスクショの通り）。今回のスクショで `/api/inspect?...` を開いて **UIが出てる**のがその証拠。

**結論：俺が決める。**
このまま **pages.dev 配下で `/api/*` をWorkersにルーティングするのは基本ムリ**（pages.devは自分のドメインじゃないので Workers Routes を切れない）。
なので **UIを `workers.dev` 側の `/api/inspect` に向ける**。そのために **Task 14 の枝番で修正**する。

---

## Task 14-1 でできるようになること（完了後・ざっくり）

* 入力して「Inspect」を押すと、**本物の `/api/inspect`（Workers）**を叩けるようになる
* 返ってきた **JSONがそのままRaw JSONに表示**される（HTML混入が消える）
* **CORS対応**が入り、Pages（UI）→ Workers（API）の通信が通る

---

## ✅ タスク文ここから

````md
# Task 14-1 — Fix UI → Workers API wiring (CORS) (Phase 1 / Stage 5)

## PR title rule (MUST)
Set the PR title to:
- **Task 14-1: Wire UI to Workers /api/inspect (CORS)**

## Goal
Fix the current broken behavior where `/api/inspect` on `*.pages.dev` returns HTML (Pages) instead of JSON (Workers).
Make the UI call the Workers deployment directly and ensure CORS allows the request.

## Why this is needed (context)
- On `pages.dev`, `/api/inspect` is NOT routed to Workers; it falls back to the Pages HTML.
- Result: UI receives HTML and JSON parse fails.
- Fix: UI must call the Workers endpoint (workers.dev) and Workers must allow CORS.

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**`
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `app/**`, `workers/**`, `README.md` (minimal if needed)
- Must NOT edit: `docs/specs/**`

---

## Requirements

### 1) Add configurable API base URL (UI)
Update `app/app.js` (or `app/index.html`) to use an API base URL.

Rules:
- Default to same-origin first: `""`
- If same-origin `/api/inspect` responds with HTML (or non-JSON), fallback to `WORKERS_API_BASE`.
- `WORKERS_API_BASE` must be configurable via a simple constant at top of `app/app.js`:

Example:
```js
const WORKERS_API_BASE = "https://REPLACE_ME.workers.dev"; // user will replace
````

Behavior:

* Primary attempt: `fetch("/api/inspect?...")`
* If response `Content-Type` does NOT include `application/json`, then:

  * retry once using `${WORKERS_API_BASE}/api/inspect?...`
* If `WORKERS_API_BASE` is still the placeholder, show a neutral message:

  * “API route is not connected on pages.dev. Set WORKERS_API_BASE to your deployed workers.dev URL.”

### 2) Add CORS support in Workers

Update `workers/src/index.ts`:

* For `/api/inspect` (and `/api/hello` is fine too), ensure responses include:

  * `Access-Control-Allow-Origin: *` (simple and OK for Phase 1)
  * `Access-Control-Allow-Methods: GET, OPTIONS`
  * `Access-Control-Allow-Headers: Content-Type`
* Handle preflight:

  * `OPTIONS /api/inspect` returns 204 with the above CORS headers.

### 3) Keep everything neutral

* No verdict/scoring/investment advice text added.
* No new features. Only wiring/CORS.

---

## Acceptance checklist

* [ ] UI Inspect works on `https://token-scam-inspector.pages.dev/` without “invalid JSON” errors
* [ ] Raw JSON displays actual JSON from `/api/inspect`
* [ ] `/api/inspect` on pages.dev may still show HTML (known limitation), but UI uses Workers fallback correctly
* [ ] Workers responses include CORS headers
* [ ] OPTIONS preflight returns 204 with CORS headers
* [ ] No edits to `docs/specs/**`

```

## ✅ タスク文ここまで

---

### 補足（お前がやることは1つだけ）
PRができたら、`WORKERS_API_BASE` の `REPLACE_ME` を **自分の workers.dev のURLに置換**すれば即動く。  
（これを自動推測するのは事故るので、固定で1箇所だけ手で入れる設計にする）

::contentReference[oaicite:0]{index=0}
```

https://6e68a188.token-scam-inspector.pages.dev/


