### Task 02 でできるようになること（完了後）

* **Workers側の最小構成**（設定ファイル＋入口コード）が揃う
* ブラウザで叩ける **`/api/hello`（JSON）** が用意できる（まだ検査ロジック無し）
* 次の Task 03（`/api/inspect` ダミー）に進むための **APIの土台が完成**する

---

## ✅ タスク文ここから

````md
# Task 02 — Workers Hello World + Minimal Wrangler Setup (Phase 1 / Step 2)

## PR title rule (MUST)
Set the PR title to:
- **Task 02: Workers hello world**

## Goal
Create a minimal Cloudflare Workers setup.
Implement a simple Hello endpoint (no inspect logic yet).
Local execution via Wrangler is recommended but not required for this task.

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**`
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `workers/**`, `wrangler.toml` (repo root), `README.md` (minimal, if needed)
- Must NOT edit: `docs/specs/**`

## Requirements

### 1) Add `wrangler.toml` (repo root)
Minimal config only:
- name: `token-scam-inspector`
- main: point to the Workers entry file (see below)
- compatibility_date: set to a recent date (YYYY-MM-DD)
- Do not add KV, D1, R2, queues, cron, etc.

### 2) Create Workers entry file
Create:
- `workers/src/index.ts`

Implement:
- Default export with `fetch(request, env, ctx)` handler
- Route:
  - `GET /api/hello` → returns JSON:
    ```json
    { "ok": true, "message": "hello" }
    ```
- Any other path → JSON 404:
  ```json
  { "ok": false, "error": { "code": "not_found", "message": "Not found" } }
````

Notes:

* Keep responses strictly JSON.
* No inspect endpoint yet.
* No external API calls.
* No caching yet.

### 3) Add minimal dev note (optional)

If needed, update `README.md` with 2 lines only:

* `npm i -g wrangler` (or equivalent note)
* `wrangler dev`

Do not add new specs or long docs.

## Acceptance checklist

* [ ] `wrangler.toml` exists at repo root and is minimal
* [ ] `workers/src/index.ts` exists and implements `GET /api/hello`
* [ ] Unknown paths return JSON 404
* [ ] No extra infrastructure added (DB/KV/R2/etc.)
* [ ] No edits to `docs/specs/**`
* [ ] (Optional) Confirm via `wrangler dev` if available

```
## ✅ タスク文ここまで

PR #3
https://github.com/badjoke-lab/token-scam-inspector/pull/3

snapshot
https://3cc63bd3.token-scam-inspector.pages.dev/



---

### Task 03 でできるようになること（完了後）

* `/api/inspect` が **叩ける状態**になり、成功/失敗どちらでも **必ずJSONで返る**
* `chain` と `address` の **最低限の入力チェック**が入り、壊れにくくなる
* 次の Task 04（キャッシュ導入）に進める **APIの土台**が完成する

---

## ✅ タスク文ここから

````md
# Task 03 — /api/inspect Dummy (Fixed Explainable JSON) (Phase 1 / Stage 1)

## PR title rule (MUST)
Set the PR title to:
- **Task 03: /api/inspect dummy**

## Goal
Implement `/api/inspect` as a dummy endpoint that returns a fixed, explainable JSON format.
No real inspection logic. No external API calls. No caching yet.

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**`
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `workers/**`
- May update: `README.md` (minimal, only if needed)
- Must NOT edit: `docs/specs/**`

## Requirements

### 1) Routing
Add:
- `GET /api/inspect`

Keep:
- `GET /api/hello` working as-is.

### 2) Input validation (minimum)
Accept query params:
- `chain` (required): string (accept any string for now)
- `address` (required): EVM-style address only
  - starts with `0x`
  - length is exactly 42
  - remaining 40 chars are hex only (`0-9a-fA-F`)

If missing/invalid:
- return HTTP 400 with JSON error shape (below)

### 3) Response rules (JSON only, neutral language)
Forbidden words anywhere:
- “scam”, “fraud”, “safe”
Forbidden content:
- scoring / ranking / points
- investment advice

#### 3.1) Success response (200) — fixed dummy structure
Return JSON with at least these fields:

```json
{
  "ok": true,
  "input": { "chain": "eth", "address": "0x..." },
  "result": {
    "overall": "unknown",
    "summary": [
      "This is a dummy response (no real inspection yet).",
      "It shows the output format only.",
      "No verdict / no investment advice."
    ]
  },
  "checks": [
    {
      "id": "dummy_sources",
      "label": "Data sources",
      "status": "unknown",
      "why": "External data sources are not connected in this stage.",
      "evidence": []
    },
    {
      "id": "dummy_format",
      "label": "Output format",
      "status": "ok",
      "why": "The endpoint returns explainable JSON with neutral language.",
      "evidence": []
    }
  ],
  "meta": {
    "generatedAt": "ISO_STRING",
    "cached": false
  }
}
````

Notes:

* `generatedAt` must be generated at runtime (ISO 8601).
* `status` must be one of: `ok | warn | high | unknown` (use only `ok/unknown` in this task).
* `evidence` must always be an array (empty is allowed).

#### 3.2) Error response (400) — fixed error shape

Return JSON:

```json
{
  "ok": false,
  "error": { "code": "bad_request", "message": "Human-readable message" },
  "meta": { "generatedAt": "ISO_STRING", "cached": false }
}
```

### 4) No caching in this task

* Do NOT use Cache API.
* Do NOT add any external fetches.

## Acceptance checklist

* [ ] `GET /api/inspect?chain=eth&address=0x0000000000000000000000000000000000000000` returns 200 JSON
* [ ] Missing/invalid params return 400 JSON with the fixed error shape
* [ ] `/api/hello` still works
* [ ] No external API calls
* [ ] No caching added
* [ ] No forbidden words / no scoring / no advice
* [ ] No edits to `docs/specs/**`

```

## ✅ タスク文ここまで

https://github.com/badjoke-lab/token-scam-inspector/pull/4

https://3b9d14c9.token-scam-inspector.pages.dev/




* 同じ `chain+address` の問い合わせを **24時間は使い回せる**（無駄な処理が減る）
* 外部が不安定になっても **前回の結果（古くても）を返せる**設計になる（壊れにくい）
* 無料枠で落ちにくくなる（アクセス増に耐えやすい）

---

## ✅ タスク文ここから

```md
# Task 04 — Cache API (TTL 24h + Stale Strategy) (Phase 1 / Stage 2)

## PR title rule (MUST)
Set the PR title to:
- **Task 04: cache TTL24h**

## Goal
Add caching to `/api/inspect` using Cloudflare Workers Cache API.
TTL is 24 hours. Implement a simple stale strategy.
No new inspection logic yet beyond caching.

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**`
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `workers/**`
- Must NOT edit: `docs/specs/**`

## Requirements

### 1) Cache key / scope
Cache is for `/api/inspect` responses only.

Define a cache key that varies by:
- `chain`
- `address`

Example (conceptually):
- `cacheKey = /api/inspect?chain=...&address=...`

### 2) Cache behavior (TTL 24h)
On request to `/api/inspect`:
1) Try cache first:
   - If cached response exists: return it
   - Response JSON must still include:
     - `meta.cached: true`
2) If cache miss:
   - Generate the normal dummy response (same as Task 03 output shape)
   - Store it in cache with TTL **86400 seconds**
   - Return it with:
     - `meta.cached: false`

### 3) Stale strategy (simple + safe)
If a cache entry exists but something goes wrong while generating a fresh response
(e.g. unexpected error), return the cached response as fallback.

Notes:
- Because this stage still returns dummy data, the “error while generating fresh”
  can be simulated by catching unexpected exceptions.
- Do NOT add external API calls in this task.

### 4) Headers / correctness
- Responses must remain JSON only.
- Ensure cached responses are safe to cache:
  - Set `Cache-Control: public, max-age=86400`

### 5) Do not break other routes
- `/api/hello` must keep working.

## Acceptance checklist
- [ ] First call to `/api/inspect?...` returns `meta.cached: false`
- [ ] Second call with same params returns `meta.cached: true`
- [ ] Different `chain` or `address` uses a different cache entry
- [ ] TTL is 24 hours (86400 seconds)
- [ ] `/api/hello` still works
- [ ] No external API calls added
- [ ] No forbidden words / no scoring / no advice
- [ ] No edits to `docs/specs/**`
```

## ✅ タスク文ここまで

https://github.com/badjoke-lab/token-scam-inspector/pull/5

https://7a57179f.token-scam-inspector.pages.dev/



### Task 05 でできるようになること（完了後・ざっくり）

* **/api/inspect が ETH / BSC の Explorer に“問い合わせできる土台”ができる**（本物のデータ取得の入口）
* **取得できない場合も「なぜ取れないか」を理由付きで返せる**（APIキー未設定／エンドポイント制限など）
* 次の **Task 06（チェック①）以降**で、いま作った“取得データ”を使って **判定ロジックを1つずつ載せていける**

---

## ✅ タスク文ここから

```md
# Task 05 — Explorer connect (ETH/BSC minimal fetch foundation) (Phase 1 / Stage 3)

## PR title rule (MUST)
Set the PR title to:
- **Task 05: Explorer connect foundation (ETH/BSC)**

## Goal
Add a minimal “Explorer fetch foundation” for ETH and BSC so `/api/inspect` can obtain basic contract facts.
Do NOT implement scoring, verdicts, or multiple check logics yet. (That is Stage 4 tasks.)
Keep API responses neutral and explainable.

## Source of truth (MUST FOLLOW)
- Specs: `docs/specs/**`
- Ops rules: `AGENTS.md`, `codex/**`
- Common rules: `codex/tasks/task-00-rules.md`

## Allowed changes
- May add/update: `workers/**`, `README.md` (minimal if necessary)
- Must NOT edit: `docs/specs/**`

## Requirements

### 0) Important constraints
- Do NOT add DB/KV/R2/Queues/Cron.
- Do NOT add new public endpoints beyond what already exists.
- Do NOT change the response JSON schema that was fixed in Task 04.
  - You may only fill existing fields (e.g., evidence/notes/reasons) without adding new top-level keys.

### 1) Environment variables (read-only usage)
Read API keys from `env` (do NOT hardcode):
- `ETHERSCAN_API_KEY` (used for Etherscan V2 API; also supports BSC with chainid=56)

If the key is missing:
- Do NOT fail the whole request.
- Mark affected parts as `unknown` and include an explainable reason (e.g., `missing_api_key`).

### 2) Implement an Explorer client module (Workers internal)
Create modules under `workers/src/` (exact paths are flexible, but keep it clean and small), e.g.:
- `workers/src/explorer/client.ts`
- `workers/src/explorer/types.ts`

Implement a minimal client that supports:
- Chains:
  - `eth` -> `chainid=1`
  - `bsc` -> `chainid=56`
- Base URL (Etherscan V2):
  - `https://api.etherscan.io/v2/api`

Must include:
- `fetchJsonWithTimeout(url, timeoutMs)` helper
- Safe parsing of Etherscan-style responses (status/message/result)
- Normalization of errors into a small, explainable shape:
  - `code` (e.g., `missing_api_key`, `upstream_error`, `rate_limited`, `not_supported`, `timeout`)
  - `message` (short, neutral)
  - `upstream` (optional: `etherscan`)

### 3) Minimal data to fetch (best-effort)
For a given `chain + address`, fetch best-effort facts needed for later checks:

A) Contract source / verification signal (best-effort)
- Use `module=contract&action=getsourcecode&address=...`
- Derive a *fact* such as:
  - `sourceAvailable: true/false/unknown`
  - optional: `isProxy` if upstream provides it (best-effort)
- If upstream cannot provide, return `unknown` with reason.

B) Contract creation info (best-effort)
- Use `module=contract&action=getcontractcreation&contractaddresses=...`
- Derive facts such as:
  - `creatorAddress` (or unknown)
  - `creationTxHash` (or unknown)

C) Token holder list (DO NOT require paid plan)
- If a free endpoint is not available, do NOT hack HTML scraping.
- Return `unknown` with an explainable reason like `unavailable_on_free_plan` (neutral wording).
- (This is just the foundation; later we can add an alternate free source if specs allow.)

### 4) Integrate into `/api/inspect` WITHOUT changing schema
Inside the existing `/api/inspect` flow:
- After input validation and before producing the final payload, call the explorer client to obtain the “facts”.
- Put the outcome into existing per-check fields only (no schema changes).
  - Example approach:
    - For checks related to “Contract Verification” / “Owner / Privileges” / “Holder Concentration”:
      - keep their status as `unknown` for now (Stage 4 will decide pass/fail)
      - attach evidence entries like:
        - `source: "explorer"`
        - `label: "contract source available"`
        - `value: true/false/unknown`
        - `note` with short explanation
      - If missing API key / rate limit:
        - add a neutral evidence note: “Explorer data unavailable: missing_api_key” etc.
- Do NOT modify overall / topReasons logic beyond what exists (keep it neutral).

### 5) Caching behavior must remain correct
- Your current cache logic (TTL 24h + stale fallback) must still work.
- Explorer calls should not happen on cache HIT responses.
  - i.e., keep “cache hit returns immediately” behavior.

## Acceptance checklist
- [ ] `workers/src` contains a minimal explorer client module with timeout + safe error normalization
- [ ] `/api/inspect` calls the explorer client on cache MISS only
- [ ] Response JSON schema is unchanged (only existing fields are populated)
- [ ] Missing `ETHERSCAN_API_KEY` does NOT break `/api/inspect`; affected data becomes `unknown` with a reason
- [ ] No HTML scraping for holder lists
- [ ] No edits to `docs/specs/**`
```

## ✅ タスク文ここまで

https://github.com/badjoke-lab/token-scam-inspector/pull/6

https://81f25828.token-scam-inspector.pages.dev/



Sohachi
@Sohachi_
·
3分
Task02を投げてgithubとサイトを更新しました
GPTによると01-05が土台づくりみたいな作業になるようです

プルリクエストとこの段階のスナップショットも貼っておきます

PR #3
https://github.com/badjoke-lab/token-scam-inspector/pull/3

snapshot
https://3cc63bd3.token-scam-inspector.pages.dev
Sohachi
@Sohachi_
·
3分
Task 03

PR #4
https://github.com/badjoke-lab/token-scam-inspector/pull/4

snapshot
https://3b9d14c9.token-scam-inspector.pages.dev
Sohachi
@Sohachi_
·
2分
Task 04 

PR #5
https://github.com/badjoke-lab/token-scam-inspector/pull/5

snapshot
https://7a57179f.token-scam-inspector.pages.dev
Sohachi
@Sohachi_
·
1分
Task 05

これで土台づくりパートが終了です

PR #6
https://github.com/badjoke-lab/token-scam-inspector/pull/6

snapshot
https://81f25828.token-scam-inspector.pages.dev


